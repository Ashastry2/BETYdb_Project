<html>

<head>
    <!-- css style information for the <table> -->
    <style>
        table,
        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        
        th,
        td {
            padding: 15px;
        }
        
        ul.ui-autocomplete {
            list-style: none;
            list-style-type: none;
            padding: 0px;
            margin: 0px;
        }
    </style>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.1/jquery-ui.min.js"></script>
    <script src='https://www.gstatic.com/charts/loader.js'></script>
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs5/dt-1.11.5/cr-1.5.5/sc-2.0.5/sb-1.3.2/datatables.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs5/dt-1.11.5/cr-1.5.5/sc-2.0.5/sb-1.3.2/datatables.min.css" /> -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.3.4/css/select.bootstrap5.min.css" />


    <script>
        $(function() {
            $("#hint").autocomplete({
                minLength: 3,
                source: function(request, response) {
                    $.ajax({
                        url: "https://bioed.bu.edu/cgi-bin/students_22/Group_N/bety.connect.2.py",
                        data: {
                            q: request.term,
                            query: "species"
                        },
                        dataType: 'json',
                        success: function(data) {
                            response(data);
                        }
                    });
                },
            });
        });
    </script>

    <script>
        $(document).ready(function() {
            $('#table_id_1').DataTable();
            $('#table_id_2').DataTable();
        });
    </script>

    <script>
        google.charts.load('current', {
            'packages': ['corechart', 'geochart', 'table', 'map'],
            'mapsApiKey': 'AIzaSyC8u_s8fD66gsjdCJ8PgewoDCqpi3O4Yts'
        });


        $(document).ready(function() {
            getSites()


            $("#btnradio2").click(function() {
                $("#sites_map_div").empty();

                getSitesYields()
            });

            $("#btnradio1").click(function() {
                $("#sites_map_div").empty();

                getSites()
            });
        });
    </script>

</head>

<body style="margin:10;padding:10">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="https://raw.githubusercontent.com/PecanProject/BETYdb-YABA/master/images/bety.png" alt="" width="30" height="24" class="d-inline-block align-text-top"> BETYdb
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="BETYdb.home.html">Home</span></a>

                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="getTrydb.html">PFTs</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="BETYdb.sites.html">Sites/Yields</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            External
          </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="https://www.betydb.org/">BETYdb</a></li>
                            <li><a class="dropdown-item" href="https://www.try-db.org//">TRYdb</a></li>
                        </ul>
                    </li>
            </div>
        </div>
    </nav>
    </div>

    <h2>Sites</h2>
    <div class="btn-group" role="group" aria-label="Basic radio toggle button group">

        <input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off" checked>
        <label class="btn btn-outline-primary" for="btnradio1">MAP/MAT</label>
        <input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off">
        <label class="btn btn-outline-primary" for="btnradio2">Yields</label>

    </div>

    <!-- <div class="d-flex align-items-start">
        <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
            <button class="nav-link active" id="v-pills-home-tab" data-bs-toggle="pill" data-bs-target="#v-pills-home" type="button" role="tab" aria-controls="v-pills-home" aria-selected="true" id="btnradio1">MAP/MAT</button>
            <button class="nav-link" id="v-pills-profile-tab" data-bs-toggle="pill" data-bs-target="#v-pills-profile" type="button" role="tab" aria-controls="v-pills-profile" aria-selected="false" id="btnradio">Yields</button>
        </div>
        <div class="tab-content" id="v-pills-tabContent">
            <div id="sites_map_div"></div>
            <div class="table-responsive" id="table_div"></div>
            <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">...</div>
            <div class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">...</div>
            <div class="tab-pane fade" id="v-pills-messages" role="tabpanel" aria-labelledby="v-pills-messages-tab">...</div>
            <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-settings-tab">...</div> 
    </div>
    </div> -->

    <div class="container">
        <div class="row align-items-center justify-content-start">
            <div class="col">
                <label for="exampleDataList" class="form-label">Datalist example</label>
                <input class="form-control" list="datalistOptions" id="hint" placeholder="Type to search...">

            </div>
        </div>

        <div class="row align-items-center justify-content-start">
            <div class="col">

                <div id="sites_map_div"></div>
            </div>
        </div>
        <div class="row align-items-center justify-content-start">

            <div class="col">
                <div id="table_div" class="table-responsive">
                    <table id="table_id_1" class="table table-striped table-hover display"></table>
                </div>
                <div id="table_div" class="table-responsive">
                    <table id="table_id_2" class="table table-striped table-hover display"></table>
                </div>
            </div>
        </div>
    </div>

    <script>
        function getSitesYields() {
            $.get("https://bioed.bu.edu/cgi-bin/students_22/Group_N/bety.connect.2.py", //<<< url
                {
                    query: "sites_yield"
                }, //<<< input_data
                function(data) {
                    //console.log(data["error"])    
                    if (data["error"] == 0) {
                        drawSitesYields(data["plot_data"]);
                    } else {
                        $("#sites_map_div").append(data["message"]);
                    } //<<< callback function

                },
                "json");
        }

        function getSites() {
            $.get("https://bioed.bu.edu/cgi-bin/students_22/Group_N/bety.connect.2.py", //<<< url
                {
                    query: "sites"
                }, //<<< input_data
                function(data) {
                    //console.log(data["error"])    
                    if (data["error"] == 0) {
                        drawSites(data["plot_data"]);
                    } else {
                        $("#sites_map_div").append(data["message"]);
                    } //<<< callback function

                },
                "json");
        }

        function drawSitesYields(array) {

            var data = google.visualization.arrayToDataTable(array);
            var geoView = new google.visualization.DataView(data);
            geoView.setColumns([0, 1, 2]);
            var map = new google.visualization.Map(document.getElementById('sites_map_div'));
            map.draw(geoView, {
                showTip: true
            });

            // $("#table_div").empty();
            var table = $('#table_id_2').DataTable();
            table
                .clear();
            //.invalidate()
            //                .draw();


            let table_body_contents = "";
            let rowData = "";

            //loop through rows of the data
            for (let row = 0; row < array.length; row++) {

                //miRNA name is the first element of each row
                rowData = array[row];
                lat = rowData[0];
                long = rowData[1];
                name = rowData[2];
                cultivars = rowData[3];
                scientificname = rowData[4];
                mean = rowData[5];
                //construct the table data rows
                //for string substitution with ${variable name}, use back ticks, not single or double quotes
                table_body_contents += `<tr><td>${lat}</td><td>${long}</td><td>${name}</td><td>${cultivars}</td><td>${scientificname}</td><td>${mean}</td></tr>`;
            }

            //build the entire table template and susbstitute in the table data rows and the gene name 
            let table_template = `<thead><tr><th>Latitude</th><th>Longitude</th><th>Site Location</th><th>Cultivar</th><th>Species</th><th>Mean</th></tr></thead><tbody>${table_body_contents}</tbody>`;



            $("#table_id_2").append(table_template);
            //$('#table_id').html(table_template);
            // $('#table_id')
            //     .DataTable({
            //         select: true
            //     });


            // var cssClasses = { headerRow: 'thead-dark',
            //                     headerCell: 'd-header-cell',
            //                     hoverTableRow: 'd-table-row',
            //                     selectedTableRow: 'd-table-row',
            //                      tableCell: 'd-table-cell'}; 



            // var table = new google.visualization.Table(document.getElementById('table_div'));
            // table.draw(data, {showRowNumber: false, width: '100%', height: '100%', page: "enable", 'cssClassNames':cssClasses});
            // , page: "enable"

            // google.visualization.events.addListener(table, 'select',
            // function() {
            //   map.setSelection(table.getSelection());
            // });

            // // Set a 'select' event listener for the map.
            // // When the map is selected, we set the selection on the table.
            // google.visualization.events.addListener(map, 'select',
            //     function() {
            //       table.setSelection(map.getSelection());
            //     });
        }

        function drawSites(array) {
            var data = google.visualization.arrayToDataTable(array);
            var geoView = new google.visualization.DataView(data);
            geoView.setColumns([0, 1, 3, 4]);

            var table = $('#table_id_1').DataTable();
            table
                .clear();
            //    .draw();


            var options = {
                displayMode: 'markers'
            };
            var chart = new google.visualization.GeoChart(document.getElementById('sites_map_div'));
            chart.draw(geoView, options);

            // $("#table_div").empty();

            let table_body_contents = "";
            let rowData = "";

            //loop through rows of the data
            for (let row = 0; row < array.length; row++) {

                //miRNA name is the first element of each row
                rowData = array[row];
                lat = rowData[0];
                long = rowData[1];
                name = rowData[2];
                MAP = rowData[3];
                MAT = rowData[4];
                //construct the table data rows
                //for string substitution with ${variable name}, use back ticks, not single or double quotes
                table_body_contents += `<tr><td>${name}</td><td>${lat}</td><td>${long}</td><td>${MAP}</td><td>${MAT}</td></tr>`;
            }

            //build the entire table template and susbstitute in the table data rows and the gene name 
            let table_template = `<thead><tr><th>Site Location</th><th>Latitude</th><th>Longitude</th><th>MAP</th><th>MAT</th></tr></thead><tbody>${table_body_contents}</tbody>`;

            //$("#table_div").append(table_template);
            //$('#table_id').html(table_template);
            $("#table_id_1").append(table_template);


            // var table = new google.visualization.Table(document.getElementById('table_div'));

            // var cssClasses = { headerRow: 'thead-dark',
            //                     headerCell: 'mdc-data-table__header-cell',
            //                     hoverTableRow: 'mdc-data-table__row',
            //                     selectedTableRow: 'mdc-data-table__row',
            //                      tableCell: 'mdc-data-table__cell'};


            // table.draw(geoView, {showRowNumber: false, width: '100%', height: '100%', page: "enable", 'cssClassNames':cssClasses});
        }
    </script>

</body>

</html>